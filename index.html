<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¯Ø§Ø´ Ø¨ÙˆØ±Ø¯ | Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø¹Ù‚Ù„ ÙŠØªÙ†ÙØ³</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Ø£Ù„ÙˆØ§Ù† ÙØ±Ø§Ø¦Ø­ÙŠØ© Ø¨Ø£Ø³Ù„ÙˆØ¨ Canva */
    :root{
      --bg:#fff7fb;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;

      --pink:#ec4899;
      --purple:#a855f7;
      --mint:#34d399;
      --sky:#38bdf8;

      --radius:18px;
      --shadow:0 10px 25px rgba(0,0,0,.08);
      --ring:rgba(236,72,153,.35);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
      background:var(--bg);
      color:var(--text);
    }

    header{
      background:linear-gradient(135deg,var(--pink),var(--purple),var(--sky));
      color:#fff;
      padding:28px 16px;
      text-align:center;
    }

    header h1{ margin:0 0 6px; font-size:30px; }
    header p{ margin:0; opacity:.95; }

    .wrap{ max-width:1200px; margin:auto; padding:22px 16px 40px; }

    .topbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      margin-bottom:14px;
    }

    .pill{
      background:var(--card);
      border-radius:999px;
      padding:10px 14px;
      box-shadow:var(--shadow);
      font-size:14px;
    }

    .tabs{ display:flex; gap:10px; flex-wrap:wrap; margin:14px 0 18px; }
    .tab{
      border:0; cursor:pointer;
      background:var(--card);
      padding:12px 16px;
      border-radius:999px;
      box-shadow:var(--shadow);
      font-weight:700;
      color:var(--text);
    }
    .tab.active{
      background:linear-gradient(135deg,#fff0f7,#f5f3ff,#effaff);
      box-shadow:0 0 0 4px var(--ring), var(--shadow);
      color:var(--pink);
    }

    .grid{ display:grid; grid-template-columns: 1.3fr .7fr; gap:18px; }
    @media (max-width: 1024px){
      .grid{ grid-template-columns:1fr; }
    }
    @media (max-width: 768px){
      header h1{ font-size:24px; }
      .tabs{ justify-content:center; }
      .kpis{ grid-template-columns:1fr; }
      canvas{ max-height:300px; }
    }
    @media (max-width: 480px){
      header{ padding:20px 12px; }
      header p{ font-size:14px; }
      .pill{ font-size:12px; padding:8px 10px; }
      .tab{ padding:10px 12px; font-size:14px; }
      .card{ padding:14px; }
      canvas{ max-height:240px; }
    } }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
    }

    .card h2, .sectionTitle{ color:var(--pink); margin:0 0 10px; }
    .muted{ color:var(--muted); }

    .kpis{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    @media (max-width:700px){ .kpis{ grid-template-columns:1fr; } }

    .kpi{
      background:linear-gradient(180deg,#ffffff,#fff7fb);
      border-radius:16px;
      padding:14px;
      box-shadow:var(--shadow);
    }
    .kpi .label{ font-size:13px; color:var(--muted); }
    .kpi .value{ font-size:28px; font-weight:900; color:var(--purple); }

    .charts{ display:grid; gap:16px; }
    canvas{ background:#fff; border-radius:16px; padding:14px; box-shadow:var(--shadow); max-height:420px; }

    .hidden{ display:none; }

    footer{
      text-align:center;
      padding:18px;
      color:var(--muted);
      font-size:14px;
    }

    .status{ margin-top:10px; font-size:14px; }
    .status.ok{ color:#059669; }
    .status.err{ color:#dc2626; }

    /* Lists & gallery */
    .list{ display:grid; gap:10px; }
    .item{
      border:1px solid #eef2f7;
      border-radius:14px;
      padding:12px;
      background:#fff;
    }
    .item b{ color:var(--purple); }

    .gallery{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    @media (max-width: 900px){ .gallery{ grid-template-columns:repeat(2,1fr); } }
    @media (max-width: 520px){ .gallery{ grid-template-columns:1fr; } }
    .photo{ width:100%; aspect-ratio:4/3; object-fit:cover; border-radius:16px; box-shadow:var(--shadow); background:#f3f4f6; cursor:pointer; }
  </style>
</head>
<body>
<!-- Lightbox -->
<div id="lightbox" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.65);z-index:9999;">
  <img id="lightboxImg" style="max-width:92%;max-height:92%;border-radius:18px;box-shadow:0 20px 50px rgba(0,0,0,.35);" />
</div>

<header>
  <h1>Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø¹Ù‚Ù„ ÙŠØªÙ†ÙØ³</h1>
  <p>ÙˆÙ‚Ù ØªØ¹Ù„ÙŠÙ…ÙŠ â€“ STEM | Ø±Ø¤ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© 2030</p>
</header>

<div class="wrap">

  <div class="topbar">
    
    <div class="pill">ğŸ“… Ø³Ù†Ø© Ø§Ù„ØªØ£Ø³ÙŠØ³: <b>2018</b></div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="overview">DashBoard</button>
    <button class="tab" data-tab="achievements">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</button>
    <button class="tab" data-tab="photos">Ø§Ù„ØµÙˆØ±</button>
    <button class="tab" data-tab="partners">Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</button>
  </div>

  <!-- Overview -->
  <section id="tab-overview">
    <div class="grid">
      <div class="card">
        <h2>Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</h2>
        <p>
          <b>Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø¹Ù‚Ù„ ÙŠØªÙ†ÙØ³</b> Ù…Ø¨Ø§Ø¯Ø±Ø© <b>ÙˆÙ‚Ù ØªØ¹Ù„ÙŠÙ…ÙŠ</b> ØªØ£Ø³Ø³Øª Ø¹Ø§Ù… <b>2018</b>ØŒ
          ØªÙØ¹Ù†Ù‰ Ø¨ØªÙ†Ù…ÙŠØ© Ø§Ù„ØªÙÙƒÙŠØ±ØŒ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±ØŒ ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©ØŒ Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ø´Ø§Ø±ÙŠØ¹ ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ <b>STEM</b>ØŒ
          ÙˆØ¨Ù…Ø§ ÙŠÙ†Ø³Ø¬Ù… Ù…Ø¹ Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª <b>Ø±Ø¤ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© 2030</b>.
        </p>
        <div id="status" class="status muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øªâ€¦</div>
      </div>

      <div class="card">
        <h2>Ù…Ù„Ø®Øµ Ø¥Ø­ØµØ§Ø¦ÙŠ</h2>
        <div class="kpis">
          <div class="kpi"><div class="label">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div id="kpiProjects" class="value">â€”</div></div>
          <div class="kpi"><div class="label">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</div><div id="kpiEvents" class="value">â€”</div></div>
          <div class="kpi"><div class="label">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ†</div><div id="kpiTrainees" class="value">â€”</div></div>
        </div>
      </div>
    </div>

    <div class="charts">
      <div class="card"><h3 class="sectionTitle">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø©</h3><canvas id="projectsChart"></canvas></div>
      <div class="card"><h3 class="sectionTitle">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h3><canvas id="eventsChart"></canvas></div>
      <div class="card"><h3 class="sectionTitle">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ† (Ø·Ù„Ø§Ø¨ / Ø·Ø§Ù„Ø¨Ø§Øª)</h3><canvas id="studentsChart"></canvas></div>
      <div class="card"><h3 class="sectionTitle">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ† Ø³Ù†ÙˆÙŠÙ‹Ø§</h3><canvas id="traineesByYearChart"></canvas></div>
    </div>
  </section>

  <!-- Achievements -->
  <section id="tab-achievements" class="hidden">
    <div class="card">
      <h2>Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h2>
      <div id="achievementsList" class="list"></div>
      
    </div>
  </section>

  <!-- Photos -->
  <section id="tab-photos" class="hidden">
    <div class="card">
      <h2>Ø§Ù„ØµÙˆØ±</h2>
      <div id="photosGrid" class="gallery"></div>
      
      
    </div>
  </section>

  <!-- Partners -->
  <section id="tab-partners" class="hidden">
    <div class="card">
      <h2>Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</h2>
      <div id="partnersList" class="list"></div>
      
    </div>
  </section>

</div>

<footer>Â© Ù†ÙˆÙ Ø®Ø¨ØªÙŠ â€” Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø¹Ù‚Ù„ ÙŠØªÙ†ÙØ³</footer>

<script>
  /* Ø±ÙˆØ§Ø¨Ø· Google Sheets */
  const SHEETS = {
    projects: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTdJoeiY6gtt0NaEWYFZxmhMYxT-0EPug4za-8Wl1xXI8o6PYlLn56g-Dv15i0dqsENN9Zai1ROlMA6/pub?output=csv",
    events: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQc-r6wYcwCrEnYNn1A7iFr9Lj9wi78N2-w1enXOA3UgrRSccpLkL-wi4wuO8c45ItTo2Pzz0AP7p6l/pub?output=csv",
    trainees: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS7jelgXvthN4fFi_HnZ0N9WZqOqUE1tb7sj_fH6GFDvaxQE7jZqVXQrTo2_WF8QLzHDOjHc2MPsTDc/pub?output=csv",
    achievements: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSdRNIFnC84P61R0LD57jfhTPO0iX6elBHk1wx4kDM-V9fr9EgUGp7caAhU736nymYZ317-v1sQzZ8Y/pub?output=csv",
    photos: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTuaJBwN-JC6L2ANhu3tBITSSlY8Ph_11A-8YMF6_aNVrTX7zfZYBRWsW19qv3Sav0TniXmWWkZpMYA/pub?output=csv",
    partners: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTSi20NWBWlJKeq8P9g_YGTVI8bilx6GNwzrvW3co1_R4bdN6n3B-q7akjVs0AIcFsiSi8C1eFGGxhG/pub?output=csv",
  };

  /* Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© */
  const num = (v) => {
    const n = Number(String(v ?? "").replace(/[^0-9.\-]/g, ""));
    return Number.isFinite(n) ? n : 0;
  };

  function escapeHtml(s){
    return String(s ?? "").replace(/[&<>"']/g, (c)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
  }

  // CSV parser ÙŠØ¯Ø¹Ù… Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª
  function splitCsvLine(line){
    const out=[]; let cur=""; let q=false;
    for(let i=0;i<line.length;i++){
      const c=line[i];
      if(c==='"'){
        if(q && line[i+1]==='"'){ cur+='"'; i++; }
        else q=!q;
      } else if(c===',' && !q){ out.push(cur); cur=""; }
      else cur+=c;
    }
    out.push(cur);
    return out.map(s=>s.trim());
  }

  function parseCsv(text){
    const lines = text.replace(/\r/g,'').split('\n').filter(l=>l.trim().length);
    if(!lines.length) return [];
    const headers = splitCsvLine(lines[0]).map(h=>h.replace(/^\uFEFF/,''));
    return lines.slice(1).map(l=>{
      const cells = splitCsvLine(l);
      const obj={};
      headers.forEach((h,idx)=> obj[h]= (cells[idx] ?? "").trim());
      return obj;
    });
  }

  async function loadCSV(url){
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ ÙØªØ­ØªÙŠ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± file:// Ù‚Ø¯ ÙŠÙØ´Ù„ fetch.
    // Ø§Ù„Ø£ÙØ¶Ù„ ØªØ´ØºÙŠÙ„Ù‡ Ø¹Ø¨Ø± GitHub Pages Ø£Ùˆ Ø£ÙŠ Ø³ÙŠØ±ÙØ± Ù…Ø­Ù„ÙŠ.
    const res = await fetch(url, { cache: 'no-store' });
    if(!res.ok) {
      const hint = `HTTP ${res.status}`;
      throw new Error(`CSV fetch failed (${hint})`);
    }
    const text = await res.text();
    return parseCsv(text);
  }

  function setStatus(msg, ok){
    const el = document.getElementById('status');
    el.textContent = msg;
    el.className = 'status ' + (ok ? 'ok' : 'err');
  }

  /* Charts */
  let chProjects=null, chEvents=null, chStudents=null, chTraineesByYear=null;
  const destroy = (ch)=>{ if(ch) ch.destroy(); return null; };

  function renderCharts(projects, events, trainees){
    const yearsP = projects.map(r=>String(r.Year ?? r.year ?? '').trim()).filter(Boolean);
    const countsP = projects.map(r=>num(r.ProjectsCount ?? r.projects ?? r.Count ?? r.count));

    const labelsE = events.map(r=>String(r.Type ?? r.type ?? r.Category ?? r.category ?? '').trim()).filter(Boolean);
    const countsE = events.map(r=>num(r.Count ?? r.count ?? r.EventsCount ?? r.events));

    const yearsT = trainees.map(r=>String(r.Year ?? r.year ?? '').trim()).filter(Boolean);
    const female = trainees.map(r=>num(r.Female ?? r.female ?? r.Girls ?? r.girls));
    const male   = trainees.map(r=>num(r.Male ?? r.male ?? r.Boys ?? r.boys));

    // KPIs
    document.getElementById('kpiProjects').textContent = countsP.reduce((a,b)=>a+b,0).toLocaleString('ar-SA');
    document.getElementById('kpiEvents').textContent = countsE.reduce((a,b)=>a+b,0).toLocaleString('ar-SA');
    document.getElementById('kpiTrainees').textContent = (female.reduce((a,b)=>a+b,0) + male.reduce((a,b)=>a+b,0)).toLocaleString('ar-SA');

    chProjects = destroy(chProjects);
    chProjects = new Chart(document.getElementById('projectsChart'),{
      type:'line',
      data:{ labels:yearsP, datasets:[{ label:'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', data:countsP, tension:0.35, fill:true }] },
      options:{ plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }
    });

    chEvents = destroy(chEvents);
    chEvents = new Chart(document.getElementById('eventsChart'),{
      type:'bar',
      data:{ labels:labelsE, datasets:[{ label:'Ø¹Ø¯Ø¯ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª', data:countsE }] },
      options:{ plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }
    });

    chStudents = destroy(chStudents);
    const sumF = female.reduce((a,b)=>a+b,0);
    const sumM = male.reduce((a,b)=>a+b,0);
    chStudents = new Chart(document.getElementById('studentsChart'),{
      type:'doughnut',
      data:{ labels:['Ø·Ø§Ù„Ø¨Ø§Øª','Ø·Ù„Ø§Ø¨'], datasets:[{ data:[sumF,sumM] }] },
      options:{ plugins:{ legend:{ position:'bottom' } } }
    });

    chTraineesByYear = destroy(chTraineesByYear);
    chTraineesByYear = new Chart(document.getElementById('traineesByYearChart'),{
      type:'line',
      data:{
        labels:yearsT,
        datasets:[
          { label:'Ø·Ø§Ù„Ø¨Ø§Øª', data:female, tension:0.35 },
          { label:'Ø·Ù„Ø§Ø¨', data:male, tension:0.35 },
        ]
      },
      options:{ plugins:{ legend:{ position:'bottom' } }, scales:{ y:{ beginAtZero:true } } }
    });
  }

  function renderAchievements(rows){
    const box = document.getElementById('achievementsList');
    box.innerHTML = '';
    if(!rows.length){ box.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</div>'; return; }
    rows.slice(0,120).forEach(r=>{
      const title = r.Title ?? r.title ?? 'Ø¥Ù†Ø¬Ø§Ø²';
      const date = r.Date ?? r.date ?? '';
      const desc = r.Description ?? r.description ?? '';
      const el = document.createElement('div');
      el.className='item';
      el.innerHTML = `<b>${escapeHtml(title)}</b> <span class="muted">${escapeHtml(date)}</span><div class="muted" style="margin-top:6px; line-height:1.7;">${escapeHtml(desc)}</div>`;
      box.appendChild(el);
    });
  }

  function renderPartners(rows){
    const box = document.getElementById('partnersList');
    box.innerHTML = '';
    if(!rows.length){ box.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</div>'; return; }
    rows.slice(0,120).forEach(r=>{
      const name = r.Name ?? r.name ?? 'Ø´Ø±ÙŠÙƒ';
      const type = r.Type ?? r.type ?? '';
      const note = r.Note ?? r.note ?? '';
      const el = document.createElement('div');
      el.className='item';
      el.innerHTML = `<b>${escapeHtml(name)}</b> <span class="muted">${escapeHtml(type)}</span><div class="muted" style="margin-top:6px; line-height:1.7;">${escapeHtml(note)}</div>`;
      box.appendChild(el);
    });
  }

  function extractDriveId(u){
    const url = String(u||'').trim();
    // file/d/<ID>/view
    let m = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
    if(m) return m[1];
    // open?id=<ID>
    m = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
    if(m) return m[1];
    // uc?export=view&id=<ID>
    m = url.match(/uc\?[^#]*id=([a-zA-Z0-9_-]+)/);
    if(m) return m[1];
    // googleusercontent.com/d/<ID>
    m = url.match(/googleusercontent\.com\/d\/([a-zA-Z0-9_-]+)/);
    if(m) return m[1];
    return null;
  }

  function buildImageCandidates(rawUrl){
    const url = String(rawUrl||'').trim();
    const id = extractDriveId(url);
    if(!id) return [url];

    // Ø£ÙƒØ«Ø± Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ <img> Ø¹Ø§Ø¯Ø©Ù‹
    return [
      `https://drive.google.com/thumbnail?id=${id}&sz=w1200`,
      `https://lh3.googleusercontent.com/d/${id}=w1200`,
      `https://drive.google.com/uc?export=view&id=${id}`,
      url
    ];
  }

  function renderPhotos(rows){
    const grid = document.getElementById('photosGrid');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');

    grid.innerHTML = '';
    if(!rows.length){ grid.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±.</div>'; return; }

    rows.slice(0,60).forEach(r=>{
      const raw = r.ImageURL ?? r.image ?? r.URL ?? r.url;
      if(!raw) return;
      const cap = r.Caption ?? r.caption ?? '';
      const candidates = buildImageCandidates(raw);

      const wrap = document.createElement('div');
      const img = document.createElement('img');
      img.className='photo';
      img.loading='lazy';
      img.alt = cap || 'ØµÙˆØ±Ø©';

      let idx = 0;
      img.src = candidates[idx];
      img.onerror = () => {
        idx++;
        if(idx < candidates.length){ img.src = candidates[idx]; }
      };

      img.onclick = ()=>{
        lightboxImg.src = img.src;
        lightbox.style.display='flex';
      };

      wrap.appendChild(img);
      if(cap){
        const c = document.createElement('div');
        c.className='muted';
        c.style.marginTop='6px';
        c.textContent = cap;
        wrap.appendChild(c);
      }
      grid.appendChild(wrap);
    });

    lightbox.onclick = ()=>{
      lightbox.style.display='none';
      lightboxImg.src='';
    };
  }

  /* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
  (async()=>{
    // Ù†Ø³ØªØ®Ø¯Ù… allSettled Ø­ØªÙ‰ Ù„Ùˆ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ ÙØ´Ù„ Ù…Ø§ ÙŠÙˆÙ‚Ù Ø§Ù„Ø¨Ø§Ù‚ÙŠ
    const results = await Promise.allSettled([
      loadCSV(SHEETS.projects),
      loadCSV(SHEETS.events),
      loadCSV(SHEETS.trainees),
      loadCSV(SHEETS.achievements),
      loadCSV(SHEETS.photos),
      loadCSV(SHEETS.partners),
    ]);

    const names = ['projects','events','trainees','achievements','photos','partners'];
    const data = {};
    const failed = [];

    results.forEach((r,i)=>{
      if(r.status==='fulfilled') data[names[i]] = r.value;
      else failed.push(`${names[i]}: ${r.reason?.message || r.reason}`);
    });

    try{
      if(data.projects && data.events && data.trainees){
        renderCharts(data.projects, data.events, data.trainees);
      }
      if(data.achievements) renderAchievements(data.achievements);
      if(data.photos) renderPhotos(data.photos);
      if(data.partners) renderPartners(data.partners);

      if(failed.length){
        setStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ… (ÙŠÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù„Ù… ØªÙØ­Ù…Ù‘Ù„)', true);
        console.warn('CSV load issues:', failed);
      } else {
        setStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…', true);
      }
    } catch(e){
      console.error(e);
      setStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ­Ù‚Ù‚ÙŠ Ù…Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„Ø´ÙŠØª).', false);
    }

    // Ø¥Ø°Ø§ ÙÙŠ Ù…Ù„ÙØ§Øª ÙØ´Ù„Øª: Ø£Ø¹Ø±Ø¶ ØªÙ„Ù…ÙŠØ­ ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„Ù€ Console
    if(failed.length){
      console.warn('Fix hints: ØªØ£ÙƒØ¯ÙŠ Ø£Ù† Google Sheet Ù…Ù†Ø´ÙˆØ± Public ÙƒÙ€ CSVØŒ ÙˆØ´ØºÙ„ÙŠ Ø§Ù„ØµÙØ­Ø© Ø¹Ø¨Ø± GitHub Pages ÙˆÙ„ÙŠØ³ file://');
    }
  })();

  /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
  document.querySelectorAll('.tab').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('section[id^="tab-"]').forEach(s=>s.classList.add('hidden'));
      const section = document.getElementById('tab-'+btn.dataset.tab);
      if(section) section.classList.remove('hidden');
    });
  });

  /********************
   * Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø³ÙŠØ·Ø© (Console) Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙƒØ³Ø± CSV parsing
   ********************/
  (function runTests(){
    try{
      const sample = 'Year,ProjectsCount\n2018,2\n2019,4\n';
      const rows = parseCsv(sample);
      console.assert(rows.length===2, 'CSV rows length');
      console.assert(rows[0].Year==='2018', 'CSV header Year');
      console.assert(rows[1].ProjectsCount==='4', 'CSV value');

      const sample2 = 'Name,Note\n"A, B","hello \"world\""\n';
      const rows2 = parseCsv(sample2);
      console.assert(rows2[0].Name==='A, B', 'Quoted comma');
      console.assert(rows2[0].Note==='hello "world"', 'Escaped quotes');
    } catch (e) {
      console.error('Tests failed', e);
    }
  })();
</script>

</body>
</html>
